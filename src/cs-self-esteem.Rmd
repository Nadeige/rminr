---
title: "The effects of negative mental imagery on self-esteem"
author: "Sophie Homer, Paul Sharpe"
output: html_document
---

```{r setup, include=FALSE}
## DEVELOPERS: Uncomment one option, as appropriate

## Data required to knit
## https://github.com/ajwills72/rminr-data/tree/master/going-further/sses.csv
##
## I check out rminr-data and make a symbolic link to going-further

## Show only commands.
## knitr::opts_chunk$set(echo = TRUE, message = FALSE, results='hide', fig.keep = 'none', comment=NA)

## Show commands and output.
knitr::opts_chunk$set(echo = TRUE, comment=NA, cache = TRUE)
options(tibble.width = Inf) # show all columns in output
library(pander)
```

## Before you start

This is an advanced worksheet, which assumes you have completed the [Absolute Beginners' Guide to R](https://ajwills72.github.io/rminr/#beginners) course, the [Research Methods in Practice (Quantitative section)](https://benwhalley.github.io/rmip/overview-quantitative.html) course, and the [Intermediate Guide to R](https://ajwills72.github.io/rminr/#rmip) course.

## Contents

- [Introduction](#intro)
- [Preprocessing](#preproc)
- [Calculating descriptive statistics](#descriptives)
- [Checking SSES reliability](#cronbach)

<a name="intro"></a>

## Introduction

This worksheet describes a partial analysis pipeline for an experiment taken from a PhD thesis. The experiment explored self-esteem before and after a mental imagery intervention. Self-esteem was measured using the State Self-Esteem Scale (SSES, Osman et al., 2012), a 20-item survey used to measure short-lived (state) changes in self-esteem. Participants completed one of two mental imagery conditions, or a control condition:

 * Condition 1: participants visualised a negative mental image of themself
 * Condition 2: participants visualised a negative mental image of someone else
 * Condition 0 (control): participants did a card sorting task and did not think of any images.

This was a 2 (time) x 3 (condition) mixed design.

<a name="preproc"></a>

## Preprocessing

The initial preprocessing steps for this data are described in the [Data preprocessing for scales worksheet](preproc-scales.html). Complete that worksheet first, then add the code in this worksheet to the end of `scales.R`.

```{r preproc, message=FALSE, echo=FALSE}
# from tables.R
rm(list = ls()) # clear the environment
library(tidyverse)

# DASS-21
dass21_raw <- read_csv("going-further/dass21.csv")
dass21_raw <- dass21_raw %>% select(partID, Age:DASS21)
dass21 <- dass21_raw %>% drop_na()
dass21 <- dass21 %>%
  mutate(depression = rowSums(dass21[4 + c(3,5,10,13,16,17,21)]))
dass21_total <- dass21 %>% select(partID, Age, Gender, depression)
dass21 <- mutate(dass21, anxiety = rowSums(dass21[4 + c(2,4,7,9,15,19,20)]))
dass21 <- mutate(dass21, stress = rowSums(dass21[4 + c(1,6,8,11,12,14,18)]))

# SSES
sses <- read_csv('going-further/sses.csv')
sses_pre_raw  <- sses %>% select(1, 5:25)
sses_pre_raw  <- sses_pre_raw %>%
  set_names(~ str_to_lower(.) %>% str_replace_all("pre_sse_", "q"))
sses_pre_raw <- sses_pre_raw %>%
  mutate(subj = factor(partid), condition = factor(condition),
         time = factor('pre')) %>%
  select(subj, condition, time, q1:q20)

sses_pre_raw  <- select(sses, 1, 5:25) %>%
  set_names(~ str_to_lower(.) %>% str_replace_all("pre_sse_", "q")) %>%
  mutate(subj = factor(partid), condition = factor(condition),
         time = factor('pre')) %>%
  select(subj, condition, time, q1:q20)
sses_post_raw <- select(sses, 1, 25:45) %>%
  set_names(~ str_to_lower(.) %>% str_replace_all("post_sse_", "q")) %>%
  mutate(subj = factor(partid), condition = factor(condition), time = factor('post')) %>%
  select(subj, condition, time, q1:q20)
```

We start with some final bits of preprocessing.

```{r}
sses_raw <- bind_rows(sses_pre_raw, sses_post_raw)
sses_raw <- sses_raw %>%
  mutate(total = sses_raw %>% select(q1:q20) %>% rowSums())
```

### Explanation of commands

`bind_rows()` simply joins data frames together, in the order the arguments are specificed, making a new data frame. We do this because we want to do at least one analysis on all of the data.

The `mutate()` in the second line uses `rowSums()` to add up the values in the columns `q1:q20` for each row. Because our data has one participant per row, this calculates the SSES score for each participant. You've seen something similar when we calculated subscale scores in the [Data preprocessing for scales](preproc-scales.html#subscales). The SSES contains some reverse-coded items, but these were already reversed in this particular dataset, so we didn't need to do that step.

<a name="descriptives"></a>

## Calculating descriptive statistics

We can get a feel for our data by using the familiar `group_by()` and `summarise()` commands to calculate means and standard deviations by group within time.

```{r descriptive}
sses_raw %>%
  group_by(time, condition) %>%
  summarise(mean = mean(total), sd = sd(total))
```

From these results, we can see that, compared to the pre-intervention scores, self-esteem rose slightly in `other` condition, rose even more in the `self` condition and dropped slightly in the `control` condition.

<a name="cronbach"></a>

## Checking SSES reliability

To check the reliability of our SSES measurements, we'll calculate Cronbach's alpha for all of the SSES data. Cronbach's alpha was introduced in the [Analysing scales worksheet](analyse-scales.html).

```{r cronbach-all}
library(psy)
sses_cronbach_total <- sses_raw %>% select(q1:q20) %>% cronbach()
```

This could be a cause for conern, as the value of `r round(sses_cronbach_total$alpha,2)` is quite a bit lower than the alpha of 0.92 reported by the authors of the SSES (Heatherton & Polivy, 1991).

We'll do an additional analysis to see how the scale was performing in each group.

```{r cronbach-pre-post}
sses_raw %>%
  group_by(time, condition) %>%
  select(q1:q20) %>%
  group_modify(~ as.data.frame(cronbach(.x)$alpha))
```

### Explanation of commands

The first two steps in this pipeline should be familiar by now. We group the data by `condition` within `time` and select the columns required for calculating alpha. The final step needs some unpacking. The `group_modify()` command does some processing on each group of rows defined by the earlier `group_by()` and returns the result as a data frame, with columns to indicate which group the results relate to. The `~` means turn the following commands into a function which is run for each group. You don't really need to know what a function is to understand the processing that happens for each group. That's defined by `as.data.frame(cronbach(.x)$alpha)`. This runs the `cronbach()` function on the grouped data (`.x`) and extracts the value of `alpha` (recall that `cronbach()` also returns the sample size and the number of items). The alpha value is turned into a data frame so that `group_modify()` can join the results from each group into a single data frame.

### Explanation of output

We can now see that alpha looks acceptable in all conditions.

<a name="baseline"></a>

## Compare baseline SSES scores between conditions

See also: [Within-subject differences](anova1.html).

We would like to check that there were no major self-esteem differences between conditions before our intervention. This should be the case if we successfully randomised participants to conditions. If there are baseline differences we would need to account for these when comparing them to post-intervention scores. We can use a between-subjects ANOVA to compare the baseline SSES scores in our three conditions.

```{r baseline}
library(BayesFactor, quietly = TRUE)
bf <- anovaBF(formula = total ~ condition,
              data = as.data.frame(sses_raw %>% filter(time == 'pre')))
bf
```

The Bayes factor of `0.68` is greater than the conventional `0.33` which would satisfy us that there were no differences between the conditions. Our descriptive statistics show that the pre-intervention mean and standard deviation are slightly lower in the `other` condition. We'll address this issue in the next section.

```{r baseline-descriptives}
sses_raw %>% filter(time == 'pre') %>% group_by(condition) %>% summarise(mean = mean(total), sd = sd(total))
```

<a name="prepost"></a>

# Compare pre and post intervention SSES scores between conditions

See also: [Factorial differences](anova3.html).

The main question we'd like to answer is whether our two imagery interventions 
(visualising a negative mental image of oneself, or someone else) had effects on self esteem which differed from our control condition. We can test this using a [factorial ANOVA](anova3.html#bfact) to compare SSES scores before and after the three interventions. In this design, `condition` is a between-subjects variable, and `time` (pre and post intervention) is a repeated measure.

```{r prepost}
bf <- anovaBF(formula = total ~ time*condition + subj,
              data = sses_raw, whichRandom = 'subj')
```

Our Bayes factors indicate that there is a main effect of `condition`,

```{r condition}
bf[1]
```

no main effect of `time`,

```{r time}
bf[2]
```

and a `condition*time` interaction

```{r condition*time}
bf[4] / bf[3]
```

Given the interaction, we would might want to make [pairwise comparisons](anova1.html#pairs), to compare the imagery conditions against the control condition, and against each other.

Finally, to address the difference in baseline scores, we could run the same ANOVA on the _difference_ between the pre and post scores, or we could include the baseline score as a covariate in an ANCOVA. These techniques are outside the scope of this worksheet.

# References

Heatherton, T. F., & Polivy, J. (1991). Development and validation of a scale for measuring state self-esteem. _Journal of Personality and Social Psychology, 60(6)_, 895.
___

This material is distributed under a [Creative Commons](https://creativecommons.org/) licence. CC-BY-SA 4.0.