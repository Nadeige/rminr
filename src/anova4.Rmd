---
title: "More on Bayesian ANOVA"
author: "Andy Wills, Clare Walsh, Paul Sharpe"
output: html_document
---

```{r setup, include=FALSE}
## DEVELOPERS: Uncomment one option, as appropriate

## Show only commands.
## knitr::opts_chunk$set(echo = TRUE, message = FALSE, results='hide', fig.keep = 'none', comment=NA)

## Show commands and putout.
knitr::opts_chunk$set(echo = TRUE, comment=NA, cache = TRUE)
```

# Contents

- [Introduction](#intro)

- [Getting started](#start)

- [Two between-subject factors](#twoBS)

- [Exercise 1](#ex1)

- [Two within-subject factors](#twoWS)

- [Exercise 2](#ex2)

- [One between-subject factor](#oneBS)

- [More than two factors?](#three)

<a name="intro"></a>

# Introduction

This worksheet builds on three previous worksheets: [within-subject differences](anova1.html), [understanding interactions](anova2.html), and [factorial differences](anova3.html). We therefore assume you are familiar with the concepts and commands in those worksheets. If that is not the case, read (or re-read) those worksheets before proceeding.

In the [factorial differences](anova3.html)  worksheet, we did a two-factor Bayesian ANOVA where one factor was within-subject and the other was between-subjects. In this worksheet, we'll use the same data frame to illustrate another couple of two-factor ANOVAs.

<a name="start"></a>

# Getting started

Return to the project that you used for the [factorial differences](anova3.html) worksheet, which you named **rminr-data**. Open a new blank script and save it as **anova4.R**. Put all commands in that script, and save the script regularly. 

First, you'll need to load some standard packages, and the data we used in the previous worksheet:

```{r init, message=FALSE}
rm(list = ls())
library(tidyverse)
library(BayesFactor, quietly = TRUE)
words <- read_csv("wordnaming2.csv")
```

Next, you need to create a subject-level summary file that contains all the factors available in this dataset. This includes two factors we haven't analysed yet - `sex` (biological sex of the participant) and `block` (block of trials in the experiment: 1, 2, 3):

```{r factsum, message=FALSE}
wordsum <- words %>%
    group_by(subj, sex, medit, congru, block) %>% summarise(rt = mean(rt))
wordsum$sex <- factor(wordsum$sex)
wordsum$subj <- factor(wordsum$subj)
wordsum$medit <- factor(wordsum$medit)
wordsum$congru <- factor(wordsum$congru)
wordsum$block <- factor(wordsum$block)
```


<a name="twoBS"></a>

# Two between-subject factors

We can use `anovaBF` to do a factorial Bayesian ANOVA where both factors are between-subjects. It works exactly the same way as before. For example, we can do a factorial Bayesian ANOVA for  `sex` and `medit` like this:

```{r bf-2bs}
bf2bs <- anovaBF(
    formula = rt ~ medit*sex + subj,
    data = data.frame(wordsum),
    whichRandom = 'subj')
```

## Explanation of output

This analysis will take a long while to run (at least three minutes). The output is interpreted the same way as before: 

```{r reveal}
bf2bs
```

### `[1] sex`

This is the **main effect** of participant sex. More specifically, it is the hypothesis that `sex`  affects `rt`. This is compared against the hypothesis that there is no effect of sex.

The Bayes Factor is about 1.8, meaning the evidence for a main effect of sex is inconclusive.

### `[2] medit`

This is the **main effect** of training type, `medit`. More specifically, it is a test of the hypothesis that `medit`, affects `rt`. 

The Bayes Factor for this hypothesis is around 980, which is strong evidence that there is a main effect of meditation training. If you've got a particularly good memory, you'll have noticed this isn't quite the same Bayes Factor as we saw for the main effect of meditation in [this analysis](anova3.html#ex1) of the same data. As with many forms of multi-factor ANOVA (including traditional, p-value, ones) the evidence terms you get depend somewhat on the formula you specify. Here, you included `sex` but not `congru` as factors; in the previous analysis, it was the other way around. This can affect the results you get. 

If the type of analysis you choose to conduct affects the central conclusions of your study, then that is normally an indication that you need to replicate your result with a larger sample. Conclusions should be robust to variations in analysis technique.

### The interaction

As before, `anovaBF` does not directly give us a Bayes Factor for the interaction of the two main effects. Instead, it gives us two Bayes Factors for things that we can use to work out the interaction BF. These are:

#### [3] `sex + medit`

This the hypothesis that there is a main effect of both factors. There is no assumption that the two main effects are of the same size. This 'main effects' hypothesis is compared against the null hypothesis, i.e. that neither `medit` nor `sex` affect `rt`. 

The BF for this hypothesis is large (about 2000). We'd expect this, given that there was substantial evidence for `medit` alone.

#### [4] `sex + medit + sex:medit`

This is the Bayes Factor for the hypothesis that there are main effects for both factors (`sex + medit`) _and_ that the two factors interact (`+ sex:medit`). This is again compared against the null hypothesis that neither `medit` nor `sex` have any effect. 

The BF for this hypothesis is also large (about 160). We'd expect this, because there was substantial evidence for the 'main effects' hypothesis `medit + congru`. However, the BF is considerably lower than for this `main effects` hypothesis.

#### Interaction BF

The Bayes Factor for the interaction is given, as before, by:

```{r int-fact}
bf2bs[4] / bf2bs[3]
```

This gives us a Bayes Factor for the interaction close to 0.1. So, there's substantial evidence for the _absence_ of an interaction.

<a name="ex1"></a>

<a name="twoWS"></a>

# Two within-subject factors

We can also use `anovaBF` to look at two within-subjects factors. Again, this works just the same way as before. For example, we can do a factorial Bayesian ANOVA for `congru` and `block` like this:

```{r bf-2ws}
bf2ws <- anovaBF(
    formula = rt ~ congru*block + subj,
    data = data.frame(wordsum),
    whichRandom = 'subj')
```

## Explanation of output

This analysis will take a long while to run (at least seven minutes). The output is interpreted the same way as before: 

```{r reveal-2}
bf2ws
```

### `[1] congru`

The is the **main effect** of congruence. More specifically, it is the hypothesis that `congru`  affects `rt`. This is compared against the hypothesis that there is no effect of sex.

The Bayes Factor is very large (about $1 \times 10^{58}$), meaning the evidence for a main effect of congruence is conclusive.

### `[2] block`

This is the **main effect** of test `block`. More specifically, it is a test of the hypothesis that `block`, affects `rt`. 

The Bayes Factor for this hypothesis is around 0.01, which is strong evidence for the _absence_ of an effect of block. 

### The interaction

As before, `anovaBF` does not directly give us a Bayes Factor for the interaction of the two main effects. Instead, it gives us two Bayes Factors for things that we can use to work out the interaction BF. These are:

#### [3] `congru + block`

This the hypothesis that there is a main effect of both factors. There is no assumption that the two main effects are of the same size. This 'main effects' hypothesis is compared against the null hypothesis, i.e. that neither `congru` nor `block` affect `rt`. 

The BF for this hypothesis is large - about $1 \times 10^{56}$. We'd expect this, given that there was substantial evidence for `congru` alone.

#### [4] `congru + block + congru:block`

This is the Bayes Factor for the hypothesis that there are main effects for both factors (`congru + block`) _and_ that the two factors interact (`+ congru:block`). This is again compared against the null hypothesis that neither `congru` nor `block` have any effect. 

The BF for this hypothesis is also large - about $4 \times 10^{52}$. We'd expect this, because there was substantial evidence for the 'main effects' hypothesis `congru + block`. However, the BF is considerably lower than for the `main effects` hypothesis.

#### Interaction BF

The Bayes Factor for the interaction is given, as before, by:

```{r int-fact-2}
bf2ws[4] / bf2ws[3]
```

This gives us a Bayes Factor for the interaction close to 0.0004. So, there's substantial evidence for the _absence_ of an interaction.


# Exercise 1

The data for this exercise comes from a different between-subjects experiment with two factors. Start by loading the data and removing any missing data (`NA`), using this command:

```{r ex1-data, message=FALSE}
cf_raw <- read_csv('going-further/counterfactual.csv') %>% drop_na()
```

In this experiment, participants read a scenario describing some events leading up to an accident. The scenario was written from either a first-person or a third-person perspective. Next, they generated some counterfactual thoughts in relation to the scenario. For example, "If only I hadn't been looking at my phone, then ...". These thoughts were coded as either predictive, or not predictive of whether the accident occurred. Participants rated how much the protagonist was to blame for the accident, on a scale of 1 (strongly disagree) to 7 (strongly agree).

It's crucial to look at your data before analysing it. Start by calculating the mean `blame` score in each of the four conditions of this experiment. You can do this using the `group_by` and `summarise` commands that we have covered in many previous worksheets; for example, in the [group differences](group-differences.html#group) worksheet. 

If you've done it correctly, your means should look like this:

```{r ex1a, echo=FALSE, message=FALSE}
cf <- cf_raw %>%
    mutate(subj = factor(subj), perspective = factor(perspective),
           predictability = factor(predictability))
cf_sum <- cf %>% group_by(perspective, predictability) %>% summarise(blame=mean(blame))
cf_sum
```

Next, plot those means in a line graph - this helps you visualize the patterns in these data. Plotting of line graphs was covered in the [understanding interactions](anova2.html#linegraph) worksheet. Your graph should look like this:

```{r ex1b, echo=FALSE, message=FALSE}
cf_sum %>%
    ggplot(aes(x = perspective, y = blame, group = predictability, colour = predictability)) +
    geom_line() +
    geom_point() +
    theme_bw()
```

Now, do your Bayesian ANOVA. Set each of the independent variables as a `factor` and then use `anovaBF` to conduct the Bayesian ANOVA. There is only one observation for each participant in this dataset, so we can't use `subj` as a random factor, so don't include `subj` in the formula, or `whichRandom=subj`. 

Your results should look similar to this:

```{r ex1, echo=FALSE, message=FALSE}
cf_bf <- anovaBF(blame ~ perspective*predictability, data=data.frame(cf))
cf_bf
cf_bf[4] / cf_bf[3]
```

**Write a short paragraph explaining what, on the basis of your analysis, you can conclude from these data. Copy this paragraph, and the code you used to do your analysis, into PsycEL**


<a name="ex2"></a>

# Exercise 2

The data for this exercise comes from a different within subjects experiment with two factors.

```{r ex2-data, message=FALSE}
raw <- read_csv('case-studies/chris-mitchell/priming-faces.csv')
```

Participants were trained to associate two screen colours with pictures of two different food rewards. At test, they saw pairs of screen colours and food pictures. Their reaction time (RT) in milliseconds was measured for identifying whether the pairs matched (congruent), or didn't match (incongruent) the associations they'd learnt previously. This test was carried out with, and without, a secondary task. In the secondary task, the participant had to verbally rate how much they liked pictures of faces. All participants completed all conditions, so we have a fully between subjects design, with factors congruency (congruent, incongruent) and load (load, no load).

Filter the data to only include test trials. These have the value 'Test' in the `Running` column. Calculate means for each subject for the two factors. You'll need the include `na.rm = TRUE` when calculating the mean, as the data in `RT` contains some `NA` values.

Calculate Bayes Factors for the main effects and the interaction. Your results should look similar to this:

```{r ex2, echo=FALSE, message=FALSE}
priming <- raw %>%
    filter(Running == 'Test') %>%
    mutate(Subject = factor(Subject), Congruency = factor(Congruency),
           Load = factor(Load)) %>%
  group_by(Subject, Congruency, Load) %>%
  summarise(RT = mean(RT, na.rm = TRUE))

priming_bf <- anovaBF(RT ~ Congruency*Load + Subject, data=priming,
                      whichRandom = 'Subject')
priming_bf
priming_bf[4] / priming_bf[3]
```

**Copy the R code you used for this exercise into PsycEL.**

<a name="oneBS"></a>

# Single between-subjects factor

It is also possible to use `anovaBF` to analyse a single factor, between-subjects design. Where that factor has two levels, you could alternatively use [ttestBF](evidence.html#bayes-t), although note even in this case the Bayes Factors produced by the two commands will not be exactly the same. This is because `anovaBF` makes use of the factor of participant ID (`subj`), while `ttestBF` does not. The approach `anovaBF` takes is better, but also takes longer to run.  As before, if your choice of analysis technique changes the central conclusions of your study, this is normally an indication that you should replicate your study with a larger sample.

One of the useful things about `anovaBF` is that, unlike `ttestBF`, you can use it in a one-factor design that has more than two levels. For example:

```{r bf-1bs}
bf1bs <- anovaBF(
    formula = rt ~ medit + subj,
    data = data.frame(wordsum),
    whichRandom = 'subj')
bf1bs
```

<a name="three"></a>

# More than two factors?

The previous analysis took several minutes to run. Although in principle it is possible to run Bayesian ANOVAs with more than two factors, they take hours or days to run with realistically large data sets. They also produce output that is considerably harder to interpret than the output of two-factor analyses. For these reasons, we only look at up to two-factor Bayesian ANOVA in these intermediate-level worksheets. If you need to conduct an ANOVA with more than two factors, consider using [traditional ANOVA](more-on-anova.html) techniques (bearing in mind, of course, the interpretative difficulties surrounding p values). 

___


This material is distributed under a [Creative Commons](https://creativecommons.org/) licence. CC-BY-SA 4.0. 


