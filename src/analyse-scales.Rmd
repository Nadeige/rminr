---
title: "Analysing scales"
author: "Paul Sharpe, Andy Wills, Sophie Homer"
output: html_document
---

```{r setup, include=FALSE}
## DEVELOPERS: Uncomment one option, as appropriate

## Data required to knit
## https://github.com/ajwills72/rminr-data/tree/master/going-further/sses.csv
##
## I check out rminr-data and make a symbolic link to going-further

## Show only commands.
## knitr::opts_chunk$set(echo = TRUE, message = FALSE, results='hide', fig.keep = 'none', comment=NA)

## Show commands and output.
knitr::opts_chunk$set(echo = TRUE, comment=NA, cache = TRUE)
options(tibble.width = Inf) # show all columns in output
```

# Contents

- [Introduction](#intro)

- [Getting started](#start)

- [Calculating Cronbach’s alpha](#cronbach)

<a name="intro"></a>

# Introduction

This worksheet describes analyses you are likely to need when working with pscyhometric scales.

<a name="start"></a>

# Getting started

To prepare for this worksheet:

1. Open the project you used to complete the [Preprocessing scales worksheet](preproc-scales.html).
1. Add the code below to the end of `scales.R`.

<a name="cronbach"></a>

# Calculating Cronbach’s alpha

Cronbach's alpha measures the internal consistency of a scale, using correlations between different groupings of individual scale items. Values of alpha range from 0-1, with higher numbers indicating a more reliable scale. When a new scale is developed, its reliability is normally reported using Cronbach's alpha. It's wise to ensure that the alpha for your sample data is similar to this value.

We'll demonstrate the calculation of Cronbach's alpha for the State Self-Esteem Scale (SSES), which was introduced in the [Preprocessing scales worksheet](preproc-scales.html). As you will recall, this experiment used the SSES to measure self-esteem before and after a mental imagery intervention. This was a 2 (time) x 3 (condition) mixed design, with the following experimental conditions:

 * Condition 1: participants visualised a negative mental image of themself
 * Condition 2: participants visualised a negative mental image of someone else
 * Condition 0 (control): participants did a card sorting task and did not think of any images.

```{r echo=FALSE}
# from tables.R
rm(list = ls()) # clear the environment
library(tidyverse)

# DASS-21
dass21_raw <- read_csv("going-further/dass21.csv")
dass21_raw <- select(dass21_raw, partID, Age:DASS21)
dass21 <- dass21_raw %>% drop_na()
dass21 <- mutate(dass21, depression = rowSums(dass21[4 + c(3,5,10,13,16,17,21)]))
dass21 <- mutate(dass21, anxiety = rowSums(dass21[4 + c(2,4,7,9,15,19,20)]))
dass21 <- mutate(dass21, stress = rowSums(dass21[4 + c(1,6,8,11,12,14,18)]))

# SSES
sses <- read_csv('going-further/sses.csv')
sses_pre_raw  <- select(sses, 1, 5:25) %>%
  set_names(~ str_to_lower(.) %>% str_replace_all("pre_sse_", "q")) %>%
  mutate(subj = factor(partid), condition = factor(condition), time = factor('pre')) %>%
  select(subj, condition, time, q1:q20)
sses_post_raw <- select(sses, 1, 25:45) %>%
  set_names(~ str_to_lower(.) %>% str_replace_all("post_sse_", "q")) %>%
  mutate(subj = factor(partid), condition = factor(condition), time = factor('post')) %>%
  select(subj, condition, time, q1:q20)
sses_raw <- bind_rows(sses_pre_raw, sses_post_raw)
reverse_questions <- c('q2', 'q4', 'q5', 'q7', 'q8', 'q10', 'q13', 'q15', 'q16', 'q17', 'q18', 'q19', 'q20')

sses_rev <- sses_raw
sses_rev[,reverse_questions] <- 4 - sses_raw[,reverse_questions]
sses_raw <- mutate(sses_raw, total = rowSums(sses_raw[4:23]))
```

We'll use the `cronbach()` function from the `psy` package to calculate Cronbach's alpha for the SSES. You may need to install this package before you can use it for the first time -- if so, use `install.packages('psy')`.

```{r cronbach-all}
library(psy)
sses_cronbach_total <- select(sses_raw, q1:q20) %>%
  cronbach()
sses_cronbach_total$alpha
```

**Explanation of commands:**

1. The `cronbach()` function expects a wide data frame (one row per subject), with columns containing the scale scores. We supply this using the function `select(sses_raw, q1:q20)`. Notice how we can use the column names to specify the range of columns to `select()`.

1. In addition to the value of alpha, `cronbach()` returns the number of subjects and the number of items. Here were only interested in alpha, which we print with `sses_cronbach_total$alpha`.

This gives us a value of `0.94`, which is very similar to the `0.92` reported by the authors who developed the SSES (Heatherton & Polivy, 1991).

```{r cronbach-pre-condition, echo=FALSE, eval=FALSE}
# in case alpha by group comes back into scope
sses_raw$condition <- recode_factor(sses_raw$condition, `0` = 'control',
                                        `1` = 'self', `2` = 'other')
sses_cronbach_pre <- sses_raw %>%
  filter(time == 'pre') %>%
  group_by(condition) %>%
  select(q1:q20) %>%
  group_map(~ cronbach(.x))
sses_cronbach_pre
```

# References

Heatherton, T. F., & Polivy, J. (1991). [Development and validation of a scale for measuring state self-esteem](http://www.academia.edu/download/37381608/91_Heatherton_Polivy_JPSP.pdf) _Journal of Personality and Social Psychology, 60(6)_, 895.

___

This material is distributed under a [Creative Commons](https://creativecommons.org/) licence. CC-BY-SA 4.0. 

